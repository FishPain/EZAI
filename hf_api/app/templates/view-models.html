<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trending Model</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }

        nav {
            display: flex;
            align-items: center;
            background-color: #333;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 14px 20px;
            font-size: 16px;
            display: block;
            transition: color 0.3s;
            position: relative;
        }

        nav a:hover {
            color: #ddd;
        }

        nav a::after {
            content: '';
            display: block;
            width: 100%;
            height: 2px;
            background-color: #aaa;
            position: absolute;
            left: 0;
            bottom: 0;
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        nav a:hover::after {
            transform: scaleX(1);
        }

        nav a.active {
            color: #ddd;
        }

        nav a.active::after {
            transform: scaleX(1);
        }

        .nav-links {
            display: flex;
            justify-content: space-around;
            flex-grow: 1;
        }

        .filter-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .filter-container label {
            font-weight: bold;
            margin-right: 10px;
        }

        .filter-container select {
            padding: 8px;
            font-size: 14px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .filter-item {
            display: flex;
            align-items: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        th,
        td {
            padding: 15px;
            border: 1px solid #ddd;
            text-align: center;
            word-wrap: break-word;
            cursor: pointer;
        }

        th {
            background-color: #f2f2f2;
        }

        th span {
            font-size: 12px;
            margin-left: 5px;
        }
    </style>
</head>

<body>
    <nav>
        <div class="nav-links">
            <a href="/view-models">View Models</a>
            <a href="/view-contributors">Top Model Contributor</a>
        </div>
    </nav>

    <!-- Filter Section -->
    <div class="filter-container">
        <div class="filter-item">
            <label for="modelTypeFilter">Model Type:</label>
            <select id="modelTypeFilter" onchange="filterModels()">
                <option value="all">All Types</option>
                <option value="tensorflow">TensorFlow</option>
                <option value="pytorch">PyTorch</option>
            </select>
        </div>
    </div>

    <table id="modelTable">
        <thead>
            <tr>
                <th onclick="sortTable(0)">Model Name <span id="sortIndicator0">▼</span></th>
                <th onclick="sortTable(1)">Model Type <span id="sortIndicator1">▼</span></th>
                <th onclick="sortTable(2)">Upload Date <span id="sortIndicator2">▼</span></th>
                <th>S3 URL</th>
            </tr>
        </thead>
        <tbody>
            <!-- Model data will be populated here -->
        </tbody>
    </table>

    <script>
        let models = [];

        // Fetch data from the API and populate the table
        async function fetchModelData() {
            try {
                const response = await fetch('http://localhost:5001/v1/api/model_manager/all');
                const data = await response.json();

                if (data.body && data.body.body) {
                    models = data.body.body; // Store models in a global variable
                    populateModelTable(models);
                } else {
                    console.error("Invalid data format", data);
                }
            } catch (error) {
                console.error("Error fetching model data:", error);
            }
        }

        // Function to populate the table with model data
        function populateModelTable(modelData) {
            const tbody = document.getElementById('modelTable').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';  // Clear any existing rows

            modelData.forEach(model => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = model.model_name;
                row.insertCell(1).textContent = model.model_type;
                row.insertCell(2).textContent = new Date(model.upload_datetime).toLocaleDateString();
                row.insertCell(3).innerHTML = `<a href="${model.s3_url}" target="_blank">${model.s3_url}</a>`;
            });
        }

        // Function to filter the table based on the selected model type
        function filterModels() {
            const typeFilter = document.getElementById('modelTypeFilter').value.toLowerCase();

            const filteredModels = models.filter(model => {
                if (typeFilter === 'all') {
                    return true; // Show all models
                }
                return model.model_type.toLowerCase() === typeFilter;
            });

            populateModelTable(filteredModels); // Re-populate the table with filtered data
        }

        // Sort function to sort the table columns
        function sortTable(columnIndex) {
            const tbody = document.getElementById("modelTable").getElementsByTagName("tbody")[0];
            const rows = Array.from(tbody.rows);
            let sortDirection = "asc";

            if (tbody.dataset.sortedColumn == columnIndex) {
                sortDirection = tbody.dataset.sortDirection === "asc" ? "desc" : "asc";
            }
            tbody.dataset.sortedColumn = columnIndex;
            tbody.dataset.sortDirection = sortDirection;

            rows.sort((rowA, rowB) => {
                const cellA = rowA.cells[columnIndex].textContent.toLowerCase();
                const cellB = rowB.cells[columnIndex].textContent.toLowerCase();

                if (columnIndex === 2) { // Sorting by date
                    return sortDirection === "asc"
                        ? new Date(cellA) - new Date(cellB)
                        : new Date(cellB) - new Date(cellA);
                } else {
                    return sortDirection === "asc"
                        ? cellA.localeCompare(cellB)
                        : cellB.localeCompare(cellA);
                }
            });

            // Append the sorted rows back to the tbody
            rows.forEach(row => tbody.appendChild(row));
        }

        // Call the function to fetch model data when the page loads
        window.onload = fetchModelData;
    </script>
</body>

</html>